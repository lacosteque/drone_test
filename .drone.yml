kind: pipeline
type: docker
name: default

environment:
  HOME_DIR: nerd_builder
  TEMP: temp

steps:

- name: make structure
  image: alpine:3.15
  volumes:
  - name: builder_dir
    path: /tmp/
  commands:
  - |
    mkdir -p "~/$${HOME_DIR}/src/usr/bin/" \
             "~/$${HOME_DIR}/src/usr/share/" \
             "~/$${HOME_DIR}/$${TEMP}" \
             "~/$${HOME_DIR}/output"

        
- name: micro install
  image: alpine:3.15
  volumes:
  - name: builder_dir
    path: ~
  commands:
  - apk add --update --no-cache micro
  - mv $(which micro) "~/$${HOME_DIR}/src/usr/bin/nerdmicro"
  depends_on:
  - make structure

volumes:
- name: builder_dir
  host:
    path: /tmp/

- name: configs
  temp: {}

- name: docker-socket
  host:
    path: /var/run/docker.sock

- name: docker-plugins
  host:
    path: /var/lib/docker/plugins/
